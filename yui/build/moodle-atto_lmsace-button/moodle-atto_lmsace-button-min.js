YUI.add("moodle-atto_lmsace-button",function(Y,NAME){var COMPONENT="atto_lmsace",row_visual='<div class="visual-content"> Plus test</div> ',ELEMENTS=[],THUMBLIST=Y.Node.create('<div class="elements-list-parent"> </div>'),elements_list_output="",ELEMENTS_DIALOGUE=null,visual_output="",THIS=null,CODEKEY="LMSACE",CSS_ATTR={ELEMENTTHUMB:"element-thumb-parent",ELEMENTADDED:"added-element",TABCONTENT:"tab-content",ELEMENTFORM:"lmsaceElementForm",CODESLIST:"codes-list",BUTTONSAVE:"button-save",SAVELAYOUT:"save_layout",CANCELLAYOUT:"cancel_layout",EDITITEM:"edit_element_item"},SELECTORS={ADDELEMENT:"#addelement a",ELEMENTTHUMB:"."+CSS_ATTR.ELEMENTTHUMB,ELEMENTADDED:"#"+CSS_ATTR.ELEMENTADDED,TABCONTENT:"."+CSS_ATTR.TABCONTENT,ELEMENTFORM:"#"+CSS_ATTR.ELEMENTFORM,CODESLIST:"#"+CSS_ATTR.CODESLIST,BUTTONSAVE:"#"+CSS_ATTR.BUTTONSAVE,SAVELAYOUT:"#"+CSS_ATTR.SAVELAYOUT,CANCELLAYOUT:"#"+CSS_ATTR.CANCELLAYOUT,EDITITEM:'[data-func="'+CSS_ATTR.EDITITEM+'"]'},TEMPLATES={THUMBBOX:'<div class="element-thumb {{CSS_ATTR.ELEMENTTHUMB}}" data-elementid="{{DATA.id}}"><div class="img-block"><i class="{{DATA.icon}}"></i></div><div class="element-title"><span>{{DATA.title}}</span></div></div>',VISUALLAYOUT:'<div id="lmsbuilder-visual" ><div class="visual-tab"><div class="elements-list" id="{{CSS_ATTR.ELEMENTADDED}}" ></div><div id="addelement"><a href="javascript:void(0);" class="add-element-icon"> <i class="fa fa-plus"></i></a></div></div><div class="code-tab" > <div class="codes-list" id="{{CSS_ATTR.CODESLIST}}" > {{codelist}}</div></div><div class="save-button-layout"><input type="button" id="{{CSS_ATTR.SAVELAYOUT}}" value="Save" ><input type="button" id="{{CSS_ATTR.CANCELLAYOUT}}" value="Cancel" ></div></div>',FORM:'<div class="lmsace-builder-form element-add-form"><div class="form-parent-wrapper"> <form class="lmsace-element-form" id="{{CSS_ATTR.ELEMENTFORM}}" ><ul class="nav nav-tabs" id="lmsace-builder-tabs">{{#tabs}}<li class="nav-item"><a class="nav-link active" id="{{name}}-tab" data-toggle="tab" href="#{{name}}" role="tab" aria-controls="{{name}}" aria-selected="true">{{title}}</a></li>{{/tabs}}</ul><div class="{{CSS_ATTR.TABCONTENT}}" id="lmsace-builder-tabs">{{#tabs}}<div class="tab-pane" id="{{name}}" role="tabpanel" aria-labelledby="{{name}}-tab">{{#fields}}{{{formfield}}}{{/fields}}</div>{{/tabs}}</div><div class="element-save-parent" > <button type="submit" class="btn btn-primary" id="{{CSS_ATTR.BUTTONSAVE}}" > SAVE </button> </div></form></div></div>',FORM_FIELDS:{TEXT:'<div class="lmsace_builder_field form-field-text"><label for="{{name}}">{{title}}</label><input type="text" name="{{name}}" id="{{name}}" placeholder="" value="{{default}}" ></div>',SELECT:'<div class="lmsace_builder_field form-field-select"><label for="{{name}}">{{title}}</label><select name="{{name}}" id="{{name}}" class="form-control" >{{#options}}<option value="{{value}}" > {{title}} </option>{{/options}}</select></div>',CHECKBOX:'<div class="lmsace_builder_field form-field-checkbox"><label for="{{name}}">{{title}}</label>{{#options}}<input type="checkbox" name="{{name}}" value="{{options.value}}"  > <label> {{options.title}}</label>{{/options}}</div>'},BUILDERITEMTOPTIONS:'<div class="list"> <p class="edit-element-item" data-func="edit_element_item" data-elementid="{{id}}" data-codeuid="{{uid}}" data-params="{{params}}" > Edit </p><p class="edit-element-item" data-func="delete_element_item" data-elementid="{{id}}" data-codeuid="{{uid}}" > Delete </p> </div> ',ELEMENT_ITEM_DIV:'<div class="lmsace-builder-item element-{{id}}" id="{{id}}" data-elementid="{{id}}"><div class="builder-item-options"> {{{BUILDERITEMTOPTIONS}}} </div><div class="builder-maincontnt" > {{{output}}}</div></div>',SHORTCODE:'[LMSACE {{#params}}{{params.name}}="{{params.value}}" {{/params}} ]'},BUILDER_DIALOGUE,ELEMENTFORM_DIALOGUE,ELEMENTS_DIALOGUE,SELECTION_DATA;function Row(){}function Column(){}Y.namespace("M.atto_lmsace").Button=Y.Base.create("button",Y.M.editor_atto.EditorPlugin,[],{_selected_point:null,_host:null,initializer:function(){this._host=this.get("host"),this.addButton({title:"pluginname",icon:"i/addblock",callback:this.show_builder}),THIS=this},show_builder:function(){if(bodycontent=codeslist=null,this._selected_point=this.get("host").getSelection(),this._selected_point.length)for(var e=0;e<this._selected_point.length;e++)typeof(SELECTION_DATA=this._selected_point[e].startContainer.data)!=undefined&&null!=SELECTION_DATA&&SELECTION_DATA.includes("[LMSACEBUILDER]")&&(codeslist=this._load_shortcode_visual_body());bodycontent=this.build_dialogue_body(codeslist),null==BUILDER_DIALOGUE&&(this._dialogue=null,BUILDER_DIALOGUE=this.getDialogue()),BUILDER_DIALOGUE.set("headerContent","LMSACE Builder"),BUILDER_DIALOGUE.set("width","80%"),BUILDER_DIALOGUE.set("bodyContent",bodycontent),BUILDER_DIALOGUE.show(),this._registerformfields()},build_dialogue_body:function(e=""){var t=this;return option={codelist:e},(visual_output=t._rendertemplate(TEMPLATES.VISUALLAYOUT,option)).all(SELECTORS.ADDELEMENT).on("click",function(){t._display_elements_list()},t),visual_output.one(SELECTORS.SAVELAYOUT).on("click",function(){THIS._insert_builder_content()}),visual_output.delegate("click",function(){dataset=this.get("dataset")},SELECTORS.EDITITEM),visual_output},_load_shortcode_visual_body:function(){var e,t;if(null!=SELECTION_DATA){for(e="",t=/\[LMSACE (.+?)?\]?(.+?)?(\[\/LMSACE\])/g;null!==(elementslist=t.exec(SELECTION_DATA));)e+=elementslist[0];return e}},_rendertemplate:function(e,t=null){var e=Y.Handlebars.compile(e);return config=Y.merge({CSS_ATTR:CSS_ATTR,SELECTORS:SELECTORS,COMPONENT:COMPONENT,TEMPLATES:TEMPLATES},t),console.log(t),Y.Node.create(e(config))},_register_editevent:function(){THUMBLIST.all(SELECTORS.ELEMENTTHUMB).each(function(e){e.on("click",function(e){e.preventDefault(),e=this.getAttribute("data-elementid"),e=ELEMENTS[e],THIS._add_selected_element(e)})})},_registerformfields:function(){for(var e in TEMPLATES.FORM_FIELDS
)field=TEMPLATES.FORM_FIELDS[e],Y.Handlebars.registerPartial(e,field);Y.Handlebars.registerHelper("formfield",function(){var e=this.type.toUpperCase(),e=TEMPLATES.FORM_FIELDS[e];return Y.Handlebars.render(e,this)})},_add_selected_element:function(t){var e=THIS._rendertemplate(TEMPLATES.FORM,t.form_fields());e.all(".form-parent-wrapper").each(function(e){e.delegate("submit",function(e){e.preventDefault();e=$(SELECTORS.ELEMENTFORM).serializeArray();THIS._generate_shortcode_form(t,e)},SELECTORS.ELEMENTFORM,THIS)}),ELEMENTS_DIALOGUE.hide(),""!=t.form_fields()&&this._update_dialogue_content(t.addtitle,e)},_update_dialogue_content:function(e,t,l){ELEMENTS_DIALOGUE.set("headerContent",e),ELEMENTS_DIALOGUE.set("bodyContent",t).show(),$(SELECTORS.TABCONTENT).find(".tab-pane:first").addClass("active")},_display_elements_list:function(){var avail_elements,element,elem_obj,element_thumb,elementtemplate,this_obj=this;if(elements_list_output=[],avail_elements=this.get("elements"),Object.keys(ELEMENTS).length<=0){for(let i=0;i<avail_elements.length;i++)element=avail_elements[i],elem_obj=eval(element),element_thumb={DATA:elem_obj.prototype.element_thumb()},console.log(element_thumb),elementtemplate=this_obj._rendertemplate(TEMPLATES.THUMBBOX,element_thumb),elem_obj.prototype.element_event_register(elementtemplate),THUMBLIST.append(elementtemplate),ELEMENTS[element.toLowerCase()]=elem_obj.prototype;this_obj._register_editevent()}this._dialogue=null,null==ELEMENTS_DIALOGUE?ELEMENTS_DIALOGUE=this.getDialogue({headerContent:"Elements list",width:"50%",bodyContent:THUMBLIST}):(ELEMENTS_DIALOGUE.set("bodyContent",THUMBLIST),ELEMENTS_DIALOGUE.set("headerContent","Elements List")),ELEMENTS_DIALOGUE.show()},_generate_shortcode_form:function(e,t,l){var i=THIS._generate_uid(),a=e.element_thumb().id,n=' type="'+a+'"',n=' id="'+i+'"';t.forEach(function(e){n+=" "+e.name+'="'+e.value+'"'}),shortcode="["+CODEKEY+" "+n+"][/"+CODEKEY+"]",$(SELECTORS.CODESLIST).append(shortcode),i={output:THIS._rendertemplate(e.element_output()).get("outerHTML"),id:a,BUILDERITEMTOPTIONS:THIS._rendertemplate(TEMPLATES.BUILDERITEMTOPTIONS,{id:a,uid:i,params:n}).get("outerHTML")},visual_output.one(SELECTORS.ELEMENTADDED).append(THIS._rendertemplate(TEMPLATES.ELEMENT_ITEM_DIV,i)),ELEMENTS_DIALOGUE.hide()},_generate_uid:function(){return"yui_"+Date.now()},_insert_builder_content:function(){var e=$(SELECTORS.CODESLIST).html();this.get("host").setSelection(this._selected_point),e="[LMSACEBUILDER]"+e+"[/LMSACEBUILDER]",this.get("host").insertContentAtFocusPoint(e),BUILDER_DIALOGUE.hide()}},{ATTRS:{elements:{value:null}}}),Row.prototype={addtitle:"Add Row",element_thumb:function(){return{id:"row",icon:"fa fa-list",title:"Row"}},element_output:function(){return'<div class="{{CSS_ATTR.ADDEDELEMENTCLASS}}"><div class="row-bar col col-md-12"><p class="bar-content"><div class="left-options"><ul class="column-counts" ><li data-col="1"> 1 column </li><li data-col="2"> 2 column </li><li data-col="3"> 3 column </li><li data-col="4"> 4 column </li></ul></div></p><div class="row-elements"><div class="row-contents"></div><div id="addelement"><a href="javascript:void(0);" class="add-element-icon"> <i class="fa fa-plus"></i> </a></div></div></div></div>'},element_event_register:function(e){},form_fields:function(){return{tabs:[{name:"general",title:"General",fields:[{name:"row_height",title:"Row Height",type:"select",temp:"SELECT","default":"1",options:[{value:"default",title:"Default from Theme Options"},{value:"auto",title:"Equals the content height"},{value:"small",title:"Small"},{value:"medium",title:"Medium"},{value:"large",title:"Large"},{value:"huge",title:"Huge"},{value:"full",title:"Full Screen"}]},{name:"width",title:"Full width content",type:"checkbox",temp:"CHECKBOX","default":"0",options:[{value:1,title:"Stretch content of this row to the screen width"}]},{name:"bg_video",title:"Background Video",type:"text",temp:"TEXT","default":"",placeholder:""}]}]}}},Column.prototype={element_thumb:function(){return{id:"column",icon:"fa fa-columns",title:"Column"}},element_output:function(){return""},element_event_register:function(){},thumb_output:function(){return'<div class="column-thumb {{CSS_ATTR.ELEMENTTHUMB}}"><div class="img-block"><i class="fa fa-column"></i></div><div class="element-title"><span>Column</span></div></div>'},form_fields:function(){return[]}}},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});